\section{Protocolo In-Band}
\label{sec:ana_inband}

En esta secci칩n, se tomar치 la decisi칩n de seleccionar el protocolo de control in-band que se utilizar치 en el proyecto. Despu칠s de una cuidadosa evaluaci칩n de las opciones disponibles, se ha decidido utilizar el protocolo IoTorii \cite{rojas2021outperforming}, basado en el enfoque de enrutamiento jer치rquico, como la soluci칩n m치s adecuada. Esta elecci칩n se respalda por el hecho de que el autor del proyecto ha participado activamente en el desarrollo del protocolo IoTorii, lo que garantiza un conocimiento profundo y una experiencia pr치ctica en su implementaci칩n.\\
\\
El protocolo IoTorii ofrece una serie de ventajas significativas para el control in-band en entornos de \gls{iot}. Su enfoque jer치rquico de etiquetado permite una gesti칩n eficiente y escalable de la red, al tiempo que proporciona una mayor flexibilidad y adaptabilidad a las necesidades espec칤ficas del proyecto. Adem치s, IoTorii ha sido probado y validado en diversas situaciones y escenarios, demostrando su eficacia y confiabilidad en la pr치ctica.\\
\\
En este contexto, se ha tomado la decisi칩n de hacer uso de los caminos generados por el protocolo IoTorii, donde cada nodo de la red posee rutas distintas para alcanzar el nodo ra칤z de la topolog칤a. En el caso de este proyecto, el nodo ra칤z se designar치 como el controlador (o el nodo que brinda acceso al controlador). Por lo tanto, la innovaci칩n radica en la implementaci칩n de IoTorii en un entorno de redes definidas por software (SDN).La integraci칩n de IoTorii con el entorno SDN permitir치 aprovechar las capacidades y ventajas de ambos enfoques. La combinaci칩n de la eficiencia y escalabilidad jer치rquica de IoTorii con la flexibilidad y el control centralizado de SDN ofrece un enfoque prometedor para el desarrollo y la gesti칩n de redes \gls{iot}. Este enfoque innovador proporcionar치 una base s칩lida para llevar a cabo el proyecto y permitir치 explorar nuevas posibilidades y mejoras en el 치mbito del control in-band para entornos de \gls{iot}.

\subsection{Protocolo IoTorii}

El protocolo IoTorii fue dise침ado para trabajar en redes de baja capacidad en entornos \gls{iot}, tratando de solventar carencias de otros protocolos del mismo 치mbito como \gls{rpl}, bas치ndose en dos principios: (1) Intercambiar menos mensajes y reducir el tama침o de las tablas de rutas, y (2) Ofrecer resiliencia a trav칠s de caminos de \textit{back-up}, con una exploraci칩n inicial relativamente r치pida. Dichos principios b치sicos tratan de impactar sobre el consumo y la robustez de las redes de baja capacidad, factores clave en este tipo de redes.


\subsubsection{Operativa del protocolo IoTorii}

El objetivo de IoTorii es dar cada nodo de la red por lo menos una etiqueta jer치rquica, en adelante \gls{hlm}, para establecer una jerarqu칤a en la topolog칤a. Otra forma de verlo puede ser ver la jerarqu칤a como un 치rbol que se va ramificando, y est치 enraizado en el nodo que act칰a como \textit{root}. Las \gls{hlm} tratan de proveer de m치s significado a las MACs convencionales. IoTorii est치 basado en el protocolo GA3 \cite{rojas2017ga3}, el cual trataba de buscar el mismo etiquetado jer치rquico pero en redes cableadas de Data Centers. El principio de estas etiquetas est치 basado en una revisi칩n del estandar \texttt{ieee802} que se hizo para dar cabida al uso de direcciones MAC mejoradas para el reenv칤o de paquetes en red.\\
\\
El proceso de la difusi칩n de dichas etiquetas se pueden ver en la figura \ref{fig:iotorii-operation}. El primer paso es establecer en la topolog칤a quien va a actuar como nodo \textit{root}, este caso seg칰n se puede apreciar es el nodo \texttt{A}. Este nodo ser치 el encargado de iniciar todo el proceso de asignaci칩n de etiquetas en la topolog칤a. La asignaci칩n de etiquetas empezar치 desde el \textit{root} haciendo uso de un mensaje de tipo \textit{SetHLMAC}, el cual consiste en mandar la \gls{hlm} del remitente m치s un sufijo que se asociar치 al vecino. Pero, 쮸 qu칠 consideramos vecino? La condici칩n de vecino se da cuando dos nodos se encuentran en rango de cobertura, y se han notificado entre ellos de su presencia mediante un mensaje de tipo \textit{Hello}. Dicho mensaje es una trama vac칤a donde solo anuncian su direcci칩n MAC real. \\
\\
Un s칤mil en la vida real podr칤a verse como cuando una nueva familia llega al vecindario y va casa por casa present치ndose, ``춰Hola somos nuevos aqu칤 {\DejaSans 游땎}! Acabamos de llegar al vecindario, nos hemos mudado a la casa de enfrente". Sin embargo, no te sueles presentar con todas las personas del vecindario, solo con los vecinos m치s cercanos, pporqueno te interesa que todos sepan de ti, solo aquellos con los que vayas a tener relaci칩n por cercan칤a.\\
\\
\begin{figure}[ht!]
    \centering
    \includegraphics[width=\textwidth]{archivos/img/analisis/iotorii-operation.pdf}
    \caption{Operativa del protocolo de IoTorii \cite{rojas2021outperforming}}
    \label{fig:iotorii-operation}
\end{figure}

Por tanto, seg칰n se ha explicado, habr치 dos tipos de mensajes en este protocolo los mensajes de tipo \textit{Hello} y de tipo, \textit{SetHLMAC}. Este 칰ltimo, recordemos que asigna una nueva \gls{hlm}, la cual se compone de la \gls{hlm} del remitente m치s un sufijo 칰nico que se asocia al vecino en cuesti칩n. Por ejemplo en la figura \ref{fig:iotorii-operation}, el nodo \texttt{A} asigna a sus vecinos los sufijos $\texttt{1,2,3,4,5}$, por lo que las  \gls{hlm} que mandar치 respectivamente ser치n las siguientes, $\texttt{[1.1],[1.2],[1.3],[1.4],[1.5]}$. Dichos sufijos 칰nicos por vecino se van asignando seg칰n se reciben mensajes de tipo \textit{Hello}, por lo que, se va construyendo una asociaci칩n de MAC real con sufijo 칰nico.\\
\\
Los mensajes de tipo \textit{Hello} se tienen que transmitir de forma peri칩dica para que todo el mundo tenga actualizado su lista de vecinos, ya que en este caso no se tiene una red cableada donde las relaciones entre los nodos son constantes, sino, nodos en un escenario inal치mbrico, por lo que movilidad es inherente. Por ello, de forma peri칩dica se tiene que reafirmar que sigues siendo vecino de tus nodos adyacentes. Volviendo al s칤mil de la vida real, podr칤a verse como que el vecindario en vez de ser casas al uso, son caravanas, las cuales tienen la capacidad de aparcar donde quieran del vecindario, por lo que de vez en cuando tienes que presentarte de nuevo porque puede que los vecinos que tengas no sean los mismos.\\
\\
Cuando un nodo recibe un mensaje de tipo \textit{SetHLMAC}, lo almacenan en su  tabla de posibles rutas al nodo ra칤z, y lo reenv칤an a todos sus posibles vecinos poniendo sus respectivos sufijos 칰nicos. Este proceso se lleva a cabo de forma iterativa hasta que se han difundido todas las posibles \gls{hlm} o hasta que se haya llegado al n칰mero m치ximo de \gls{hlm} por nodos (par치metro configurable del protocolo). Por ejemplo, si nos fijamos de nuevo en la figura \ref{fig:iotorii-operation}, podemos ver como siguiendo con este proceso el nodo \texttt{B} recibe del nodo root la \gls{hlm} $\texttt{[1.5]}$, por lo que, una vez almacenada la etiqueta la difundir치 a todos sus posibles vecinos. El nodo \texttt{B} generar치 las etiquetas $\texttt{[1.5.8],[1.5.1],[1.5.3]}$, y las mandar치 a sus nodos vecinos. La etiqueta $\texttt{[1.5.8]}$ le llegar치 al nodo \texttt{C} desde el nodo \texttt{B}, pero tambi칠n le llegar치 la etiqueta $\texttt{[1.3.2.8]}$ a trav칠s del nodo \texttt{B} (como se puede ver el sufijo es el mismo en ambos casos), las guardar치 y las dinfundir치 a todos sus vecinos. Para prevenir bucles solo hay que inspeccionar si la \gls{hlm} que te llega es hija de algunas que tienes guardadas en tu tabla de rutas. Por ejemplo, el nodo \texttt{B} descartar치 todas \gls{hlm} que le lleguen siguiendo el formato $\texttt{[1.5.X.Y]}$ o $\texttt{[1.3.2.X.Y]}$. Todo este proceso de difusi칩n de etiquetas \gls{hlm} se encuentra descrito en el bloque de algoritmo \ref{iotorii-alg}.\\
\\
Una vez convergida la difusi칩n de etiquetas \gls{hlm}, se tendr치 construido un 치rbol enraizado en el nodo establecido como \textit{root}, y cada hoja del 치rbol tendr치 una o m치s rutas para alcanzar al \textit{root}.

\newpage

\input{archivos/diagramas/iotorii_alg}


\subsubsection{Configuraci칩n del protocolo IoTorii}

La difusi칩n de las \gls{hlm}s puede ser configurada para ajustarse mejor sobre la red que se vaya a trabajar. Se han dejado tres par치metros de dise침o.

\begin{itemize}
    \item Longitud de \gls{hlm}, establece como de larga podr치 ser una etiqueta \gls{hlm}. Este par치metro nos indica a cuantos saltos estaremos desde una hoja del 치rbol, al nodo ra칤z.
    \item N칰mero de bits para sufijos 칰nicos, es decir, que amplitud de \gls{hlm} vamos a tener. Esto definir치 cuantos vecinos recibir치n etiquetas desde un nodo dado. Por ejemplo, si tenemos 2 bits, podremos dar cabida hasta 4 vecinos.
    \item N칰mero de \gls{hlm}, indica el n칰mero de rutas m치ximo que cada nodo guardar치 en su tabla de rutas al \textit{root}.
\end{itemize}

Todos los par치metros anteriormente mencionados afectar치n tambi칠n sobre el tama침o de la trama generada de tipo \textit{SetHLMAC}, la cual se puede apreciar en la figura \ref{fig:frameformat-setHLMAC} Otro par치metro configurable es la periodicidad de los mensajes de tipo \textit{Hello}, los cuales son fundamentales para gestionar la movilidad de los nodos en la red.

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\textwidth]{archivos/img/analisis/Comparation_frame_iotorii.eps}
    \caption{Mensajes de control en IoTorii \cite{rojas2021outperforming}}
    \label{fig:frameformat-setHLMAC}
\end{figure}